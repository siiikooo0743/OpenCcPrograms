multishell.setTitle(multishell.getCurrent(), "MasterLoop") 

function getItem(name, amount)
  print("Get Item!")
  print("Name:" .. name)
  print("Amount:" .. name)
end

function processTasks()
  print("ProcessTasks initialized!")
  while not(fs.exists("ItemSystem/stop")) do
    l = fs.list("ItemSystem/tasks")
    for _, file in ipairs(l) do 
      print("Looking for:" .. file)
      f = fs.open("ItemSystem/tasks/" .. file, "r")
      name = f.readLine()
      amount = f.readLine()
      f.close()
      getItem(name, amount)
    end
    coroutine.yield()
  end
end

function listen()
  print("Listen initialized!")
  while not(fs.exists("ItemSystem/stop")) do
    id, msg = rednet.receive()
    print("Message received!")
    print("Id:" .. id)
    print("Message:" .. msg)
    coroutine.yield()
  end
end

rednet.open("right")

parallel.waitForAll(processTasks(),  listen())
print("Done.")

